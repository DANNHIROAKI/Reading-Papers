#### 摘要

神经嵌入模型已成为现代信息检索 (IR) 流水线的核心组成部分。这些模型为每个数据点生成一个单一的嵌入向量 $x \in \mathbb{R}^{d}$，从而可以通过高度优化的最大内积搜索 (MIPS) 算法实现快速检索。近年来，从具有里程碑意义的 ColBERT 论文开始，多向量模型（每个数据点生成一组嵌入向量）在信息检索任务中取得了显著更优的表现。然而，由于多向量检索和评分的复杂性增加，这些模型的计算成本较高。

------

在本文中，我们提出了一种新的检索机制——MuVERA（多向量检索算法），该机制将多向量相似度搜索简化为单向量相似度搜索。这使得可以使用现成的 MIPS 求解器进行多向量检索。MuVERA 采用非对称方式生成查询和文档的固定维度编码（FDEs），这些编码是内积近似多向量相似度的向量。我们证明了 FDE 可以提供高质量的 $\varepsilon$ 近似，从而首次为多向量相似度提供了具有理论保证的单向量代理。

实验结果表明，与此前的最先进启发式方法相比，FDE 可以在检索候选数量减少 $2-5$ 倍的情况下实现相同的召回率。与现有的最先进实现相比，MuVERA 在 BEIR 检索数据集的多样化测试中始终表现出良好的端到端召回率和延迟表现，平均召回率提高了 $10 %$，同时延迟降低了 $90 %$。

## 1 引言

在过去十年中，使用神经嵌入来表示数据已成为信息检索 (IR) [56] 的核心工具，并广泛应用于聚类和分类等其他任务 [39]。最近，ColBERT [29] 提出的后交互框架引入了多向量 (MV) 表示，该方法在流行的 IR 基准测试中表现出了显著的性能提升。ColBERT 及其变体 [17, 21, 32, 35, 42, 44, 49, 54] 通过对每个Token生成一个嵌入向量，为每个查询或文档生成多个嵌入向量。然后，查询-文档相似度通过两组向量之间的 Chamfer 相似度（§1.1），也称为 MaxSim 操作，进行评分。

多向量表示相比单向量 (SV) 表示具有许多优势，例如更好的可解释性 [15, 50] 和更强的泛化能力 [16, 36, 51, 55]。

------

尽管多向量表示有诸多优势，但其检索成本本质上高于单向量检索。首先，对每个Token生成一个嵌入向量会使数据集中嵌入向量的数量增加若干个数量级。此外，由于非线性的 Chamfer 相似度评分，目前缺乏针对多向量检索的优化系统。具体而言，单向量检索通常通过最大内积搜索 (MIPS) 算法完成，而这些算法经过数十年的高度优化 [18]。然而，SV MIPS 无法直接用于 MV 检索。

这是因为多向量相似度是查询中每个嵌入与文档中最相似嵌入的 SV 相似度的总和。因此，包含与查询中的单个Token高度相似Token的文档，并不一定整体上与查询高度相似。因此，近年来大量研究致力于设计具有更高效率的定制多向量检索算法，以缩小 SV 和 MV 检索之间的差距 [12, 21, 42, 43]。

------

目前最突出的多向量检索方法是采用基于单向量 MIPS 的多阶段流水线。其基本版本如下：第一阶段使用 SV MIPS 找到每个查询Token最相似的文档Token。然后，收集包含这些Token的相应文档，并使用原始 Chamfer 相似度对其重新评分。我们将此方法称为单向量启发式方法。

ColBERTv2 [44] 及其优化的检索引擎 PLAID [43] 基于此方法，并在此基础上添加了多个中间裁剪阶段。尤其是 PLAID 采用复杂的四阶段检索和裁剪过程，逐步减少需要评分的最终候选集 (图 1)。

然而，如上所述，在单个查询嵌入上使用 SV MIPS 可能无法找到真正的 MV 最近邻。此外，该过程成本较高，因为每个查询嵌入需要查询一个显著更大的 MIPS 索引（因为每个文档包含多个嵌入）。

最后，这些多阶段流水线复杂且对参数设置高度敏感，正如最近一项可重复性研究所示 [37]，使得它们难以调整。

为了应对这些挑战并缩小单向量和多向量检索之间的差距，本文旨在设计更快速且简化的多向量检索算法。

---

**贡献**

我们提出了 **MUVERA**：一种基于轻量级且可证明正确的单向量 MIPS 转化机制的多向量检索方法。MUVERA 采用快速且与数据无关的转换，将向量集转换为单个向量，从而可以在高度优化的 MIPS 求解器中进行检索，并在最终阶段进行重新排序。具体而言，MUVERA 将查询和文档的多向量集 $Q, P \subset \mathbb{R}^{d}$ 转换为单个固定维度向量 $\vec{q}, \vec{p}$，称为固定维度编码 (FDEs)。这些 FDEs 的点积 $\vec{q} \cdot \vec{p}$ 近似表示 $Q, P$ 之间的多向量相似度 (§2)。

实验证明，基于 FDE 点积的检索在恢复 Chamfer 最近邻方面显著优于单向量启发式方法 (§3.1)。例如，在 MS MARCO 数据集上，我们的 FDEs 的 Recall@$N$ 超过了单向量启发式在扫描相似数量浮点数时实现的 Recall@2-5N。

------

我们在 (§2.1) 中证明了 FDE 具有强大的近似保证；具体而言，FDE 的点积可以提供对真实多向量相似度的 $\varepsilon$-近似。这是第一个具有可证明保证的 Chamfer 相似度搜索算法，其运行速度严格快于暴力搜索 (定理 2.2)。因此，MUVERA 提供了第一个通过单向量代理进行多向量检索的系统化方法。

------

我们将 MUVERA 与 PLAID 在多个 BEIR 信息检索数据集（包括广泛研究的 MS MARCO 数据集）上的端到端检索性能进行了比较。结果表明，MUVERA 是一种稳健且高效的检索机制。在我们评估的数据集中，MUVERA 的平均召回率比 PLAID 高出 $10 %$，同时平均延迟降低了 $90 %$。

此外，MUVERA 关键地引入了一种向量压缩技术——产品量化 (product quantization)，使我们能够将 FDE 压缩 $32 \times$（即将 10240 维 FDE 压缩为 1280 字节存储），并且几乎没有质量损失，从而显著降低了内存占用。

### 1.1 Chamfer 相似度与多向量检索问题  

给定两个向量集 $Q, P \subset \mathbb{R}^{d}$，Chamfer 相似度定义如下：  

$$
\operatorname{ChAmFER}(Q, P)=\sum_{q \in Q} \max _{p \in P}\langle q, p\rangle
$$

其中 $\langle\cdot, \cdot\rangle$ 表示标准向量内积。  

Chamfer 相似度是 ColBERT 后交互架构中多向量相似度的默认计算方法，该架构包括 ColBERTv2 [44]、Baleen [28]、Hindsight [41]、DrDecr [34] 和 XTR [32] 等系统。这些模型将查询和文档分别编码为向量集 $Q, P \subset \mathbb{R}^{d}$，其查询-文档相似度由 Chamfer $(Q, P)$ 给出。  

需要指出的是，Chamfer 相似度（及其距离变体）在计算机视觉 [4, 6, 14, 27, 45] 和图形学 [33] 领域有着悠久的研究历史，并且此前已在机器学习文献中用于比较嵌入集 [3, 5, 30, 48]。在这些研究中，Chamfer 相似度也被称为 MaxSim 或松弛地球移动距离 (relaxed earth mover distance)。我们选择使用 Chamfer 这一术语是因为其在历史上的优先地位 [6]。  

---

本文研究的是基于 Chamfer 相似度的最近邻搜索 (NNS) 问题。具体而言，我们给定一个数据集  

$$
D=\left\{P_{1}, \ldots, P_{n}\right\}
$$

其中每个 $P_{i} \subset \mathbb{R}^{d}$ 是一个向量集。给定一个查询子集 $Q \subset \mathbb{R}^{d}$，目标是快速找出最近邻 $P^{*} \in D$，即：  

$$
P^{*}=\arg \max _{P_{i} \in D} \operatorname{CHAMFER}\left(Q, P_{i}\right)
$$

为了使检索系统具备可扩展性，该任务必须在时间复杂度远低于暴力计算所有 $n$ 个 Chamfer 相似度 $\left(Q, P_{i}\right)$ 的情况下完成。  

### 1.2 我们的方法：将多向量搜索简化为单向量 MIPS  

**MUVERA** 是一种简化的流程，将 Chamfer 相似度搜索直接转换为最大内积搜索 (MIPS)。对于预设的目标维度 $d_{\text{FDE}}$，MUVERA 生成随机映射函数 $\mathbf{F}_{\mathrm{q}}: 2^{\mathbb{R}^{d}} \rightarrow \mathbb{R}^{d_{\mathrm{FDE}}}$（针对查询）和 $\mathbf{F}_{\text{doc}}: 2^{\mathbb{R}^{d}} \rightarrow \mathbb{R}^{d_{\mathrm{FDE}}}$（针对文档），使得对于所有查询和文档的多向量表示 $Q, P \subset \mathbb{R}^{d}$，满足以下关系式：  

$$
\left\langle\mathbf{F}_{\mathrm{q}}(Q), \mathbf{F}_{\mathrm{doc}}(P)\right\rangle \approx \operatorname{CHAMFER}(Q, P)
$$

我们将向量 $\mathbf{F}_{\mathrm{q}}(Q)$ 和 $\mathbf{F}_{\mathrm{doc}}(P)$ 称为**固定维度编码 (FDEs)**。  

MUVERA 首先将映射函数 $\mathbf{F}_{\text{doc}}$ 应用于每个文档表示 $P \in D$，并将编码后的集合 $\left\{\mathbf{F}_{\text{doc}}(P)\right\}_{P \in D}$ 索引到 MIPS 求解器中。  

给定查询 $Q \subset \mathbb{R}^{d}$，MUVERA 快速计算 $\mathbf{F}_{\mathrm{q}}(Q)$ 并将其输入到 MIPS 求解器，以检索最相似的前 $k$ 个文档 FDE 向量 $\mathbf{F}_{\text{doc}}(P)$。  

最后，我们根据原始 Chamfer 相似度对这些候选结果进行重新排序。详见图 1 的流程概述。  

需要注意的是，FDE 的一个重要优势是其映射函数 $\mathbf{F}_{q}$ 和 $\mathbf{F}_{\text{doc}}$ 是与数据分布无关的。这使得它们对分布偏移具有鲁棒性，并且易于应用于流式处理场景。  

### 1.3 多向量检索的相关工作  

早期的多向量检索系统，例如 **ColBERT** [29]，主要基于前述的单向量 (SV) 启发式方法进行优化。在这些方法中，通过对每个查询Token $q \in Q$ 查询 MIPS 索引，找到初始候选集。在 **ColBERTv2** [44] 中，文档Token嵌入首先通过 **k-means 聚类**进行分组，并在第一轮评分时使用簇的中心点代替原始Token。这项技术在 **PLAID** [43] 中进一步优化，通过四阶段流水线逐步裁剪候选集，然后进行最终重排序 (见图 1)。  

---

另一种替代方法是在 **DESSERT** [12] 中提出的。该研究的作者同样指出了 SV 启发式方法的局限性，并提出了一种基于 **局部敏感哈希 (LSH)** [20] 的算法。他们证明该算法可以在时间复杂度 $\tilde{O}(n|Q| T)$ 下恢复 $\varepsilon$-近似最近邻，其中 $T$ 大致是与任意查询Token $q \in Q$ 相似的文档Token $p \in P_{i}$ 的最大数量，该值可能达到 $\max _{i}\left|P_{i}\right|$。  

因此，在最坏情况下，该算法的运行速度并不比暴力搜索快。而相反，我们的算法可以恢复 $\varepsilon$-近似最近邻，并始终以时间复杂度 $\tilde{O}(n|Q|)$ 运行。  

实验表明，DESSERT 的速度比 PLAID 快 **2-5 倍**，但召回率较低（例如，在 MS MARCO 上 R@1000 的召回率仅为 **2-2.5%**）。相比之下，我们的算法不仅能够匹配甚至显著超过 PLAID 的召回率，同时延迟降低了 **最多 5.7 倍**。  

此外，DESSERT 仍然使用基于查询Token嵌入的 **k-means 聚类**进行初步过滤（类似于 ColBERTv2 的方法），因此并未真正克服 SV 启发式方法所存在的局限性。  