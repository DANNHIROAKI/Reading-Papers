在经过了很多次实验后，事实证明Muvera在对段落嵌入向量进行simhash的过程中有着很高的碰撞率，也就是说会把很多向量哈希到少数集中几个桶中，这是导致最终相似度计算的一大误差来源。



# 第一个Idea

我在想我们能不能，就是我们现在有一些bucket嘛

我假设我的bucket不是由LSH(SimHash)得到的，假设每个bucket是由类似kmeans得到的，然后有一个类似kmeans质心

我能不能就是定义一个Assignment的问题，

- 相当于我左边有一个质心集，右边有一个向量集，然后把向量集中的向量分配到质心集的质心去
- 保证有两个约束，第一就是每个质心的分配得到的向量数不超过某个数
- 第二个约束，让每个质心与其所分配到的向量尽可能的相似

对查询和段落都做出这样的Assignment，同样得到类似于Muvera的两个单向量，用来计算相似度

相当于就是我要得到一个向量到桶的最优的Assignment，在桶中碰撞也不是很高，而且总体最大的

然后类似muvera我们也要得到近似的查询但向量和段落但向量，使得二者内积能等于查询和段落的Chamfer距离(MaxSim)



# 第二个idea

为每个桶设定一个阈值，对段落的多向量进行分桶时，当一个桶A满了，就将本应分到该桶A的向量分到与该桶A海明距离最近的一个桶B

如果桶B也满了，则以此类推再找与B最近(排除A)的桶C，直到完成分桶



# 第三个idea

与Cuckoo Hashing的做法相结合



# 第四个idea

首先我理解的QLASH可以作为一个黑箱模型，即首先求出查询$q$的哈希值，以这个哈希值为中心构建一个桶，如果也有段落$p_i$的哈希值落入这个桶，则认为$p_i$与这个$q$是邻近的

如何与QALSH结合在一起

比如在求$\displaystyle{}\text{Chamfer}(Q,P)\text{=}\sum_{q \text{∈} Q} \max _{p \text{∈} P}\langle q, p\rangle$的求$\max _{p \text{∈} P}\langle q, p\rangle$过程中，原本需要扫描所有的$p \text{∈} P$，利用QALSH后扫描的范围可以缩小

我突然又有了一个想法，就是最理想的情况就是$q_i$落入$\displaystyle{}p_i^*\text{=}\arg\max_{p\text{∈}P}\langle{}q_i,p\rangle{}\text{=}\arg\text{MaxSim}(q_i)$所在的桶

假设现在$q_i$就刚好落入了这样的桶，假设桶中还有$\{p_1,p_2,...p_i^*,....\}$，旧有的做法时直接对$\{p_1,p_2,...p_i^*,....\}$求平均，但是我现在改进一下，我用QALSH的方法试图找到$p_i^*$或者与其接近的向量，由此可减少部分误差

以上是我一些碎片的想法，总之你要为我构思一下，如何通过QALSH的思想来优化MUVERA模型

尽可能全面的思考





