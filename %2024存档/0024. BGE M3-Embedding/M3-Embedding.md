[TOC]

åŸæ–‡ç« ï¼š[$\text{BGE M3-Embedding}$](https://doi.org/10.48550/arXiv.2402.03216) 

# $\textbf{1. }$èƒŒæ™¯ä¸å¯¼è®º

> ## $\textbf{1.1. }$ç ”ç©¶èƒŒæ™¯
>
> > :one:åµŒå…¥ä¸æ£€ç´¢
> >
> > 1. åµŒå…¥æ¨¡å‹ï¼šä¸€ç§æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå°†æ–‡æœ¬è½¬åŒ–ä¸ºå‘é‡ï¼Œä»¥æ•æ‰æ–‡æœ¬çš„æ„ä¹‰ä¿¡æ¯
> > 2. æ£€ç´¢æ–¹æ³•ï¼šå¯†é›†$\mathcal{/}$å¤šå‘é‡$\mathcal{/}$ç¨€ç–(è¯æ±‡)
> >    |    æ¨¡å‹    | åµŒå…¥æ–¹å¼                         | ç›¸ä¼¼åº¦è®¡ç®—           |     æ¨¡å‹å®ä¾‹     |
> >    | :--------: | -------------------------------- | -------------------- | :--------------: |
> >    |  å¯†é›†æ£€ç´¢  | æ•´ä¸€æ®µç¼–ç ä¸ºå•ä¸ªæ®µè½çº§ç¨ å¯†å‘é‡   | ä¸¤ä¸ªå‘é‡é—´çš„ç‚¹ç§¯è®¡ç®— |  $\text{BERT}$   |
> >    | å¤šå‘é‡æ£€ç´¢ | æ•´ä¸€æ®µç¼–ç ä¸ºå¤šä¸ªè¯æ±‡çº§ç¨ å¯†å‘é‡   | ä¸¤ç»„å‘é‡é—´çš„å¤æ‚äº¤äº’ | $\text{ColBERT}$ |
> >    |  ç¨€ç–æ£€ç´¢  | æ•´ä¸€æ®µä¸­è¯çš„é‡è¦æ€§åˆ†å¸ƒ(è¯é¡¹æƒé‡) | è¯åŒ¹é…å¾—åˆ†           |  $\text{BM25}$   |
> >
> > :two:å½“å‰åµŒå…¥æ¨¡å‹çš„å±€é™ï¼šé€šç”¨æ€§ä¸è¶³
> >
> > |      å±€é™      | æè¿°                                                       |
> > | :------------: | ---------------------------------------------------------- |
> > |   è¯­è¨€å±€é™æ€§   | å¤§å¤šæ•°æ¨¡å‹é’ˆå¯¹è‹±è¯­å¼€å‘ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸Šè¡¨ç°å·®                 |
> > |   åŠŸèƒ½å•ä¸€æ€§   | åµŒå…¥æ¨¡å‹åªé’ˆå¯¹å•ä¸€æ£€ç´¢åŠŸèƒ½**è®­ç»ƒ**                         |
> > | æ— æ³•å¤„ç†é•¿æ–‡æœ¬ | å¤§å¤šæ•°æ¨¡å‹åªèƒ½å¤„ç†çŸ­æ–‡æœ¬è¾“å…¥ï¼Œç¼˜äºè®­ç»ƒé•¿æ–‡æ¡£æ£€ç´¢å™¨æˆæœ¬å¤ªé«˜ |
>
> ## $\textbf{1.2. }$æœ¬æ–‡çš„ç ”ç©¶
>
> > :one:$\text{M3-Embedding}$çš„åŠŸèƒ½ï¼šå…‹æœé€šç”¨æ€§ä¸è¶³çš„é—®é¢˜
> >
> > |   åŠŸèƒ½   | æè¿°                                                         |
> > | :------: | ------------------------------------------------------------ |
> > |  å¤šè¯­è¨€  | æ”¯æŒ$\text{100}$å¤šç§è¯­è¨€ï¼Œå­¦ä¹ ä¸åŒè¯­è¨€çš„å…±åŒè¯­ä¹‰ç©ºé—´ï¼Œæ”¯æŒè¯­è¨€å†…$/$è·¨è¯­è¨€çš„æ£€ç´¢ |
> > |  å¤šåŠŸèƒ½  | èƒ½ç”Ÿæˆä¸‰ç§ä¸åŒç±»å‹çš„åµŒå…¥ï¼Œä»¥åŒæ—¶æ”¯æŒå¯†é›†æ£€ç´¢$\mathcal{/}$ç¨€ç–æ£€ç´¢$\mathcal{/}$å¤šå‘é‡æ£€ç´¢ |
> > | å¤šé¢—ç²’åº¦ | å¤„ç†ä¸åŒé•¿åº¦çš„è¾“å…¥ï¼Œä»ç»†é¢—ç²’åº¦çš„çŸ­è¾“å…¥$\text{â†’}$æœ€é•¿$\text{8192}$ä¸ª$\text{Token}$ |
> >
> > :two:$\text{M3-Embedding}$çš„è®­ç»ƒï¼šå¦‚ä½•æ•´åˆä¸‰ç§åµŒå…¥æ–¹å¼çš„ä¸åŒè®­ç»ƒç›®æ ‡
> >
> > 1. é«˜æ•ˆçš„æ•°æ®ç­–åˆ’ï¼š
> >    - æ•°æ®æºï¼šæ— ç›‘ç£æ•°æ®$/$ç›‘ç£æ•°æ®$/$åˆæˆæ•°æ®
> >    - ç›®çš„ï¼šäº’ä¸ºè¡¥å……ï¼Œåº”ç”¨åœ¨ä¸åŒè®­ç»ƒé˜¶æ®µ
> > 2. ä¸€ç§æ–°çš„è‡ªæˆ‘è’¸é¦æ¡†æ¶ï¼š
> >    - ç»“æ„ï¼š`<CLS>`ç»“æ„åµŒå…¥$\xrightarrow{ç”¨äº}$å¯†é›†æ£€ç´¢ï¼Œå…¶å®ƒ$\text{Token}$åµŒå…¥$\xrightarrow{ç”¨äº}$ç¨€ç–æ£€ç´¢å’Œå¤šå‘é‡æ£€ç´¢
> >    - åŸç†ï¼šæ•´åˆä¸åŒæ£€ç´¢åŠŸèƒ½äº§ç”Ÿçš„ç›¸å…³æ€§åˆ†æ•°ä¸ºæ•™å¸ˆä¿¡å·$\xrightarrow{çŸ¥è¯†è’¸é¦}$åé¦ˆç»™æ¨¡å‹è‡ªå·±ï¼Œä¸æ–­å¢å¼ºå¾ªç¯
> > 3. ä¼˜åŒ–äº†æ‰¹å¤„ç†ç­–ç•¥ï¼šå®ç°å¤§æ‰¹é‡$\text{+}$é«˜ååçš„è®­ç»ƒï¼Œä»¥æé«˜åµŒå…¥æ¨¡å‹çš„åŒºåˆ†èƒ½åŠ›
>
> ## $\textbf{1.3. }$æœ‰å…³å·¥ä½œ
>
> > :one:ä¸€èˆ¬çš„æ–‡æœ¬åµŒå…¥
> >
> > 1. æ–‡æœ¬åµŒå…¥çš„è¿›å±•ï¼šé¢„è®­ç»ƒæ¨¡å‹(æœ‰æ•ˆç¼–ç å°†æ•°æ®çš„æ½œåœ¨è¯­ä¹‰)ï¼Œå¯¹æ¯”å­¦ä¹ (è´Ÿé‡‡æ ·å’ŒçŸ¥è¯†è’¸é¦çš„è¿ç”¨)
> > 2. æ–‡æœ¬åµŒå…¥çš„è¶‹åŠ¿ï¼šå¤šåŠŸèƒ½çš„åµŒå…¥æ¨¡å‹(ç»Ÿä¸€æ”¯æŒå¤šç§åœºæ™¯)ï¼Œå¦‚$\text{E5/BGE/SGPT/Contriever... }$
> >
> > :two:$\text{IR}$çš„æ–‡æœ¬åµŒå…¥ï¼šå¯†é›†æ£€ç´¢$\mathcal{/}$å¤šå‘é‡æ£€ç´¢$\mathcal{/}$ç¨€ç–(è¯æ±‡)æ£€ç´¢
> >
> > :three:å¤šè¯­è¨€çš„æ–‡æœ¬åµŒå…¥ï¼š
> >
> > 1. å®ç°å¤šæ–‡æœ¬åµŒå…¥ï¼š
> >    |         æ–¹å‘(æ€è·¯)         | æ¨¡å‹                          |
> >    | :------------------------: | ----------------------------- |
> >    |        å¤šè¯­è¨€æ•°æ®é›†        | $\text{MIRACL/mMARCO/MKQA}$   |
> >    |  å¤šè¯­è¨€ç¼–ç å™¨**(é¢„è®­ç»ƒ)**  | $\text{mBERT/mT5/XLM-R}$      |
> >    | å¤šè¯­è¨€åµŒå…¥æ¨¡å‹**(å¾®è°ƒå)** | $\text{mDPR/mContriever/mE5}$ |
> > 2. å½“å‰çš„æŒ‘æˆ˜ï¼šå…¶ä»–è¯­ç§ä¸è‹±è¯­çš„å›ºæœ‰å·®è·ï¼Œå…¶å®ƒè¯­ç§è¯­æ–™åº“ç¨€å°‘

# $\textbf{2. M3-Embedding}$ 

> ## $\textbf{2.1. }$æ¨¡å‹æ ¸å¿ƒ: æ··åˆæ£€ç´¢æ–¹å¼
>
> > ### $\textbf{2.1.1. }$ä¸‰ç§ä¸åŒçš„æ£€ç´¢æ–¹å¼
> >
> > > #### $\textbf{2.1.1.1. }$ç¨ å¯†æ£€ç´¢
> > >
> > > > :one:åˆ†è¯ï¼šä¿ç•™`<cls>`æ ‡è®°
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\text{=}$`<q-cls> <q-Token-1> <q-Token-2> ....` 
> > > > 2. æ–‡æ¡£ï¼š$p\text{=}$`<p-cls> <p-Token-1> <p-Token-2> ....` 
> > > >
> > > > :two:åµŒå…¥ï¼šè¯çº§åµŒå…¥ï¼Œä½†é‡ç‚¹å…³æ³¨$\mathbf{H}_{\mathbf{}}[0]$ 
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}$ï¼Œå…¶ä¸­`<q-cls>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[0]$ï¼Œ`<q-Token-1>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[1]$ ....
> > > > 2. æ–‡æ¡£ï¼š$p\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}$ï¼Œå…¶ä¸­`<p-cls>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}[0]$ï¼Œ`<p-Token-1>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}[1]$ ....
> > > >
> > > > :three:å½’ä¸€åŒ–ï¼šä¸ºæ–¹ä¾¿è®¡ç®—å†…ç§¯
> > > >
> > > > 1. æŸ¥è¯¢ï¼š`<q-cls>`$\xrightarrow[\text{Norm}]{\text{Encoder}}\text{norm}\left(\mathbf{H}_q[0]\right)$ï¼Œä½œä¸º$q$çš„æœ€ç»ˆåµŒå…¥è¡¨ç¤º
> > > > 2. æ–‡æ¡£ï¼š`<p-cls>`$\xrightarrow[\text{Norm}]{\text{Encoder}}\text{norm}\left(\mathbf{H}_p[0]\right)$ï¼Œä½œä¸º$p$çš„æœ€ç»ˆåµŒå…¥è¡¨ç¤º
> > > >
> > > > :four:ç›¸ä¼¼åº¦ï¼š$s_{\text{dense}} \xleftarrow{å†…ç§¯} \langle e_p, e_q \rangle$ 
> > >
> > > #### $\textbf{2.1.1.2. }$è¯æ±‡(ç¨€ç–)æ£€ç´¢
> > >
> > > > :one:åˆ†è¯ï¼šå¯ä»¥ä¸ä¿ç•™`<cls>`æ ‡è®°
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\text{=}$`<q-Token-1> <q-Token-2> <q-Token-3> ....` 
> > > > 2. æ–‡æ¡£ï¼š$p\text{=}$`<p-Token-1> <p-Token-2> <q-Token-3> ....` 
> > > >
> > > > :two:åµŒå…¥ï¼šè¯çº§åµŒå…¥
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}$ï¼Œå…¶ä¸­`<q-Token-1>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[1]$ï¼Œ`<q-Token-2>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[2]$...
> > > > 2. æ–‡æ¡£ï¼š$p\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}$ï¼Œå…¶ä¸­`<p-Token-1>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}[1]$ï¼Œ`<q-Token-2>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[2]$...
> > > >
> > > > :three:æƒå€¼ï¼šå°†æ‰€æœ‰åµŒå…¥æ˜ å°„ä¸º$\mathbf{W}_{\mathrm{lex}}^T \mathbf{H}_q[i]$æ ‡é‡ï¼Œæ³¨æ„$\text{Token}$ç›¸åŒæ—¶å–æƒå€¼æœ€å¤§å€¼
> > > >
> > > > 1. æŸ¥è¯¢ï¼š`<q-Token-i>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[i]\xrightarrow[\text{ReLU}æ¿€æ´»å‡½æ•°]{\mathbf{W}_{\text{lex}}æƒé‡çŸ©é˜µ}w_{q_i}\text{=}\text{ReLU}\left(\mathbf{W}_{\mathrm{lex}}^T \mathbf{H}_q[i]\right)$ 
> > > > 2. æ–‡æ¡£ï¼š`<p-Token-i>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}[i]\xrightarrow[\text{ReLU}æ¿€æ´»å‡½æ•°]{\mathbf{W}_{\text{lex}}æƒé‡çŸ©é˜µ}w_{p_i}\text{=}\text{ReLU}\left(\mathbf{W}_{\mathrm{lex}}^T \mathbf{H}_p[i]\right)$ 
> > > >
> > > > :four:å¾—åˆ†ï¼šå…ˆè¿‡æ»¤å¾—æŸ¥è¯¢$q/p$å…±åŒ$\text{Token}$ï¼Œå†å°†ç›¸åŒ$\text{Token}$çš„æƒå€¼ç›¸ä¹˜ç›¸åŠ $\displaystyle{}s_{\text {lex}} \text{â†} \sum_{t \in q \cap p}\left(w_{q_t} \text{Ã—} w_{p_t}\right)$ 
> > >
> > > #### $\textbf{2.1.1.3. }$å¤šå‘é‡æ£€ç´¢
> > >
> > > > :one:åˆ†è¯ï¼šå¯ä»¥ä¸ä¿ç•™`<cls>`æ ‡è®°
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\text{=}$`<q-Token-1> <q-Token-2> <q-Token-3> ....` 
> > > > 2. æ–‡æ¡£ï¼š$p\text{=}$`<p-Token-1> <p-Token-2> <q-Token-3> ....` 
> > > >
> > > > :two:åµŒå…¥ï¼šè¯çº§åµŒå…¥
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}$ï¼Œå…¶ä¸­`<q-Token-1>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[1]$ï¼Œ`<q-Token-2>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[2]$...
> > > > 2. æ–‡æ¡£ï¼š$p\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}$ï¼Œå…¶ä¸­`<p-Token-1>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}[1]$ï¼Œ`<q-Token-2>`$\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}[2]$...
> > > >
> > > > :three:åµŒå…¥åï¼šæŠ•å½±åˆ°æƒå€¼$\text{+}$å½’ä¸€åŒ–
> > > >
> > > > 1. æŸ¥è¯¢ï¼š$q\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{q}}\xrightarrow{æƒé‡\mathbf{W}_{\mathrm{mul}}^T}\left(\mathbf{W}_{\mathrm{mul}}^T \mathbf{H}_q\right)\xrightarrow{å½’ä¸€åŒ–}\text{norm}\left(\mathbf{W}_{\mathrm{mul}}^T \mathbf{H}_q\right)$ 
> > > > 2. æ–‡æ¡£ï¼š$p\xrightarrow{\text{Encoder}}\mathbf{H}_{\mathbf{p}}\xrightarrow{æƒé‡\mathbf{W}_{\mathrm{mul}}^T}\left(\mathbf{W}_{\mathrm{mul}}^T \mathbf{H}_p\right)\xrightarrow{å½’ä¸€åŒ–}\text{norm}\left(\mathbf{W}_{\mathrm{mul}}^T \mathbf{H}_p\right)$ 
> > > >
> > > > :four:å¾—åˆ†ï¼šå°±æ˜¯$\text{ColBERT}$çš„åæœŸäº¤äº’ï¼Œ$\displaystyle{}s_{m u l} \text{ â†} \frac{1}{N} \sum_{i=1}^N \max _{j=1}^M \left\{E_q[i] \text{Ã—} E_p^T[j]\right\}$ 
> >
> > ### $\textbf{2.1.1. }$ä¸‰ç§æ£€ç´¢æ–¹å¼çš„
> >
> > > :one:é›†æˆæ–¹æ³•
> > >
> > > 1. åˆ†ç«‹ï¼šç”¨ä¸‰ç§ä¸åŒçš„æ–¹æ³•ï¼Œåˆ†åˆ«å•ç‹¬å°±è¡Œæ£€ç´¢ï¼Œå¾—åˆ°ä¸‰ä¸ªæ£€ç´¢ç»“æœ$s_{\text {dense}}/s_{\text {lex}}/s_{\text {mul}}$ 
> > > 2. æ•´åˆï¼šæœ€ç»ˆå¾—åˆ†$s_{\text {rank}} \leftarrow w_1  s_{\text {dense}}\text{+}w_2  s_{\text {lex}}\text{+}w_3  s_{\text {mul}}$ï¼Œä¸‰ä¸ªç³»æ•°ç”±ä¸åŒä¸‹æ¸¸åœºæ™¯ç¡®å®š
> > >
> > > :two:é›†æˆè¡¨ç¤ºï¼š$d^y \leftarrow \mathrm{fn}^*\left(q^x, D^y\right)$
> > >
> > > |     å‚æ•°      | å«ä¹‰                                                         |
> > > | :-----------: | ------------------------------------------------------------ |
> > > |     $q^x$     | ç”±è¯­è¨€$x$ç»™å‡ºçš„æŸ¥è¯¢$q$                                       |
> > > |     $D^y$     | ç”±è¯­è¨€$y$ç»„æˆçš„è¯­æ–™åº“$D$                                     |
> > > | $\text{fn}^*$ | å¯ä»¥æ˜¯å¯†é›†æ£€ç´¢$/$è¯æ±‡æ£€ç´¢$/$å¤šå‘é‡æ£€ç´¢ä¸­çš„ä»»ä½•ä¸€ç§å‡½æ•°ï¼Œæˆ–è€…ç»„åˆ |
> > > |     $d^y$     | ç”±è¯­è¨€$x$ç»™å‡ºçš„æŸ¥è¯¢$q$ï¼Œåœ¨ç”±è¯­è¨€$y$ç»„æˆçš„è¯­æ–™åº“$D$ä¸­ï¼Œé‡‡å–$\text{fn}^*$æ–¹å¼æ£€ç´¢ï¼Œæ‰€å¾—çš„ç»“æœ |
>
> ## $\textbf{2.2. }$æ¨¡å‹è®­ç»ƒ: ä¸€ç§æ–°çš„è‡ªè’¸é¦æ¡†æ¶
>
> > ### $\textbf{2.2.1. }$è®­ç»ƒæ•°æ®: å¤šæ ·åŒ–çš„æ•°æ®ç­–åˆ’
> >
> > > :one:å¤§è§„æ¨¡é¢„è®­ç»ƒæ•°æ®ï¼šæºäºæ— æ ‡ç­¾è¯­æ–™åº“çš„æ— ç›‘ç£æ•°æ®ï¼Œä¸€èˆ¬ä¸ºç®€å•æ¸…æ´—åçš„â€œæ ‡é¢˜-æ­£æ–‡â€ç»“æ„æ–‡æœ¬
> > >
> > > 1. æ™®é€šçš„ï¼šç»´åŸºç™¾ç§‘$\text{/S2ORC/xP3/mC4/CC-News/MTP}$
> > > 2. ç‰¹æ®Šçš„ï¼šç¿»è¯‘æ•°æ®é›†çš„å¹³è¡Œå¥å­$\text{NLLB/CCMatrix}$ï¼Œç”¨äºå­¦ä¹ è·¨è¯­è¨€çš„ç»Ÿä¸€åµŒå…¥
> > >
> > > :two:ä¸­è§„æ¨¡å¾®è°ƒæ•°æ®ï¼šæºäºæœ‰æ ‡ç­¾è¯­æ–™åº“çš„ç›‘ç£æ•°æ®
> > >
> > > | è¯­ç§ | æ¥æº                                                 |
> > > | :--: | ---------------------------------------------------- |
> > > | è‹±æ–‡ | $\text{HotpotQA/TriviaQA/NQ/MS MARCO.... }$          |
> > > | ä¸­æ–‡ | $\text{DuReader/mMARCO-ZH/T2-Ranking/CMedQAv2.... }$ |
> > > | å…¶å®ƒ | $\text{Mr. TyDi/MIRACL}$                             |
> > >
> > > :three:å°è§„æ¨¡åˆæˆæ•°æ®ï¼šæœ¬æ–‡é¢å¤–ç”Ÿæˆçš„æ•°æ®é›†ï¼Œç§°ä¹‹ä¸º$\text{MultiLongDoc}$
> > >
> > > 1. æ¥æºï¼šæŠ½å–é•¿ç¯‡æ–‡ç« çš„éšæœºæ®µè½$\text{â†’}$ç”¨$\text{ChatGPT}$ç”Ÿæˆæ®µè½çš„å¯¹åº”é—®é¢˜$\text{â†’}$å°†äºŒè€…æ•´åˆæˆæ–‡æœ¬å¯¹
> > > 2. ç›®çš„ï¼šç¼“è§£é•¿æ–‡æ¡£æ£€ç´¢ä»»åŠ¡çš„ä¸è¶³
> >
> > ### $\textbf{2.3.1. }$æŸå¤±å‡½æ•°: $\boldsymbol{\mathcal{L}_{\textbf {final}} \textbf{â†} \cfrac{\mathcal{L}+\mathcal{L}^{\prime}}{2}}$ 
> >
> > > :one:åŸºç¡€æŸå¤±å‡½æ•°$\mathcal{L}$ï¼šåŸºäºé›†æˆå­¦ä¹ åŸç†ï¼Œç›´æ¥å°†ä¸åŒæ¨¡å‹çš„é¢„æµ‹ç»“æœåŠ æƒåˆå¹¶
> > >
> > > 1. åŸå§‹æŸå¤±ï¼š$\text{InfoNCE}$æŸå¤±å‡½æ•°$\mathcal{L}_{s(\cdot)}=-\log \cfrac{\exp (\cfrac{s(q, p^*)}{\tau})}{\displaystyle{}\sum_{p \in\{p^*, P^{\prime}\}} \exp (\cfrac{s(q, p)}{\tau})}$ 
> > >    |         å‚æ•°          | å«ä¹‰                                                         |
> > >    | :-------------------: | :----------------------------------------------------------- |
> > >    |         $p^*$         | æŸ¥è¯¢$q$çš„æ­£æ ·æœ¬ï¼Œå³ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„æ®µè½æˆ–æ–‡æ¡£                  |
> > >    |         $P'$          | æŸ¥è¯¢$q$çš„è´Ÿæ ·æœ¬**é›†**ï¼ŒåŒ…å«ä¸æŸ¥è¯¢ä¸ç›¸å…³çš„æ®µè½æˆ–æ–‡æ¡£          |
> > >    | $s(q, p)$å’Œ$s(\cdot)$ | æŸ¥è¯¢$q$å’Œæ®µè½$p$ä¹‹é—´çš„ç›¸ä¼¼åº¦å¾—åˆ†ï¼Œå¯ä»¥é€šè¿‡$s_{\text{dense}}/s_{\text{lex}}/s_{\text{mul}}$ä»»ä¸€ä¸ªå¾—åˆ° |
> > >    |        $\tau$         | æ¸©åº¦å‚æ•°ï¼Œæ§åˆ¶å¾—åˆ†çš„å¹³æ»‘åº¦                                   |
> > > 2. $\mathcal{L}$çš„æ„æˆï¼š
> > >    - å¾—åˆ†çš„çº¿æ€§åŠ æƒï¼š$s_{\text {inter}} \leftarrow w_1  s_{\text {dense}}\text{+}w_2  s_{\text {lex}}\text{+}w_3  s_{\text {mul}}$ 
> > >    - æŸå¤±çš„çº¿æ€§åŠ æƒï¼š$\mathcal{L} \leftarrow \cfrac{\lambda_1  \mathcal{L}_{\text {dense}}\text{+}\lambda_2  \mathcal{L}_{\text {lex}}\text{+}\lambda_3  \mathcal{L}_{\text {mul}}\text{+}\mathcal{L}_{\text {inter}}}{4}$ 
> > > 3. ä¸€äº›æ€è€ƒï¼š
> > >    - é—®é¢˜ï¼šä¸åŒæ£€ç´¢æ–¹æ³•çš„è®­ç»ƒç›®æ ‡**ç›¸äº’å†²çª**ï¼Œå¯¹$\mathcal{L}_{\text {dense}}/\mathcal{L}_{\text {lex}}/\mathcal{L}_{\text {mul}}$åˆ†åˆ«ä¼˜åŒ–å†åŠ å’Œè¡Œä¸é€š
> > >    - è§£å†³ï¼šé€šè¿‡å¯¹$s_{\text{inter}}$è¿›è¡Œè’¸é¦ï¼Œä»¥ç»Ÿä¸€ä¼˜åŒ–ç›®æ ‡
> > >
> > > :two:è’¸é¦æŸå¤±$\mathcal{L}^{\prime}$ï¼šåŸºäºè‡ªè’¸é¦çš„æ¡†æ¶
> > >
> > > 1. åŸå§‹æŸå¤±ï¼šä¸€ç§æ”¹è¿›çš„äº¤å‰ç†µ
> > >    |                 æŸå¤±                  | æŸå¤±å…¬å¼                                                     |
> > >    | :-----------------------------------: | ------------------------------------------------------------ |
> > >    | $\mathcal{L}_{\text{dense}}^{\prime}$ | $-\left(\text{Softmax}\left(s_{\text{inter}}\right)\right) \text{Ã—} \log \left(\text{Softmax}\left(s_{\text{dense}}\right)\right)$ |
> > >    |  $\mathcal{L}_{\text{lex}}^{\prime}$  | $-\left(\text{Softmax}\left(s_{\text{inter}}\right)\right) \text{Ã—} \log \left(\text{Softmax}\left(s_{\text{lex}}\right)\right)$ |
> > >    |  $\mathcal{L}_{\text{mul}}^{\prime}$  | $-\left(\text{Softmax}\left(s_{\text{inter}}\right)\right) \text{Ã—} \log \left(\text{Softmax}\left(s_{\text{mul}}\right)\right)$ |
> > > 2. è’¸é¦æ¡†æ¶ï¼šå°†ç»¼åˆå¾—åˆ†$s_{\text{inter}}$ä½œä¸ºæ•™å¸ˆæ¨¡å‹ï¼Œæ¯ç§æ–¹æ³•çš„å¾—åˆ†$\mathcal{s}_{\text {dense}}/\mathcal{s}_{\text {lex}}/\mathcal{s}_{\text {mul}}$ä½œä¸ºå­¦ç”Ÿæ¨¡å‹
> > > 3. $\mathcal{L}^{\prime}$çš„æ„æˆï¼š$\mathcal{L}^{\prime} \leftarrow \cfrac{\lambda_1 \cdot \mathcal{L}_{\text {dense}}^{\prime}\text{+}\lambda_2 \cdot \mathcal{L}_{\text {lex}}^{\prime}\text{+}\lambda_3 \cdot \mathcal{L}_{\text {mul}}^{\prime}}{3}$ 
> >
> > ### $\textbf{2.3.2. }$è®­ç»ƒæµç¨‹: è‡ªæˆ‘è’¸é¦çš„ä¼˜åŒ–
> >
> > > <img src="https://i-blog.csdnimg.cn/direct/059e9e26adc94e2695fb3b516a137384.png" alt="image-20250105191622155" height=210 /><img src="https://i-blog.csdnimg.cn/direct/4cf979e8e3f84c4386f26b881cfed774.png" alt="image-20250105191656146" height=210 /> 
> > >
> > > :one:ç¬¬ä¸€é˜¶æ®µï¼šæ— ç›‘ç£çš„é¢„è®­ç»ƒï¼Œè®©åµŒå…¥æ¨¡å‹å…·å¤‡åŸºæœ¬æ™ºèƒ½
> > >
> > > 1. é¢„è®­ç»ƒæ•°æ®ï¼šæ”¶é›†çš„éç›‘ç£æ•°æ®
> > > 2. é¢„è®­ç»ƒæ¨¡å‹ï¼šç”¨$\text{RetroMAE}$æ–¹æ³•è°ƒæ•´è¿‡çš„$\text{XLM-RoBERTa}$æ¨¡å‹
> > > 3. é¢„è®­ç»ƒæµç¨‹ï¼šåå¤æ‰§è¡Œç¨ å¯†æ£€ç´¢$\text{â†’}$æ ¹æ®æ£€ç´¢ç»“æœé€šè¿‡å¯¹æ¯”å­¦ä¹ è°ƒæ•´å‚æ•°ï¼Œä¸æ–­é‡å¤è¿™ä¸€è¿‡ç¨‹
> > >    - **ç¨ å¯†æ£€ç´¢**ï¼šå³é¢„è®­ç»ƒä»»åŠ¡ï¼Œåœ¨æ­¤å¤„è¿˜ä¸æ¶‰åŠå…¶å®ƒæ£€ç´¢æ–¹æ³•
> > >    - **å¯¹æ¯”å­¦ä¹ **ï¼šå³é¢„è®­ç»ƒç­–ç•¥ï¼Œé€šè¿‡åŒºåˆ†æ­£è´Ÿæ ·æœ¬å¯¹çš„ç›¸ä¼¼åº¦ï¼Œå­¦ä¹ åµŒå…¥çš„è¡¨ç¤ºæ–¹æ³•
> > >
> > > :two:ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨è‡ªçŸ¥è¯†è’¸é¦è¿›è¡Œå¾®è°ƒï¼ŒåµŒå…¥æ¨¡å‹è¢«å¾®è°ƒä»¥å»ºç«‹ä¸‰ç§æ£€ç´¢åŠŸèƒ½
> > >
> > > 1. æƒé‡å‚æ•°ï¼š$w_1=1, w_2=0.3, w_3=1, \lambda_1=1, \lambda_2=0.1, \lambda_3=1$
> > >    - ç”±äº$\mathbf{W}_{\text{lex}}$æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥ä¸€å¼€å§‹$s_{\text{lex}}$å‡†ç¡®ç‡å¾ˆä½ï¼Œæ•…æœ‰æ„é™ä½å…¶æƒé‡
> > > 2. å¾®è°ƒæ•°æ®ï¼šæ”¶é›†çš„æ ‡æ³¨æ•°æ®$\text{+}$åˆæˆæ•°æ®
> > > 3. å¾®è°ƒç­–ç•¥ï¼š$\text{ANCE}$æ–¹æ³•ï¼Œå³é€šè¿‡$\text{ANN}$åŠ é€Ÿå¯»æ‰¾æ­£è´Ÿæ ·æœ¬å¯¹
>
> ## $\textbf{2.4. }$è®­ç»ƒä¼˜åŒ–: é«˜æ•ˆæ‰¹å¤„ç†
>
> > :one:æ‰€é¢ä¸´çš„é—®é¢˜
> >
> > 1. ä¸€èˆ¬æ¨¡å‹çš„è®­ç»ƒï¼šä¸€æ–¹é¢ä¿æŒæ‰¹è¶³å¤Ÿå¤§(å«è¶³å¤Ÿå¤šæ‰¹å†…è´Ÿæ ·æœ¬)ï¼Œå¦ä¸€æ–¹é¢å¯¹å¤ªé•¿çš„è¾“å…¥**ç›´æ¥æˆªæ–­**
> > 2. $\text{BGE-M3}$çš„è®­ç»ƒï¼šä¸‡ä¸‡ä¸å¯ç›´æ¥æˆªæ–­é•¿è¾“å…¥ï¼Œä¸ç„¶å°±ä¸§å¤±é˜Ÿé•¿åºåˆ—çš„å­¦ä¹ èƒ½åŠ›
> >
> > :two:è§£å†³æ–¹æ³•ï¼šä¼˜åŒ–çš„æ‰¹å¤„ç†
> >
> > <img src="https://i-blog.csdnimg.cn/direct/b8ca5cc8a36d43a6946c4e4d46b6bcf4.png" alt="image-2024874" width=500 /> 
> >
> > 1. åˆ†ç»„ï¼šè®­ç»ƒæ•°æ®æŒ‰åºåˆ—é•¿åº¦åˆ†åˆ°ä¸åŒå°ç»„(å¦‚å›¾ä¸­$\text{128/1024/4096...}$)
> > 2. é‡‡æ ·ï¼šè®­ç»ƒå®ä¾‹ä»**åŒä¸€ç»„**ä¸­æŠ½å–ä¸€éƒ¨åˆ†ä½œä¸ºè®­ç»ƒçš„$\text{Batch}$è¿›å…¥$\text{GPU}$ï¼Œè¿™ä¸€è¿‡ç¨‹æœ‰å¦‚ä¸‹ä¸¤ç§ä¼˜åŒ–
> >    - è´Ÿè½½å¹³è¡¡ï¼šä¸åŒ$\text{GPU}$é‡‡æ ·æ•°æ®æ—¶éƒ½ä¿æŒå›ºå®šéšæœºç§å­ï¼Œä½¿å¾—æŠ½åˆ°æ¯æ‰¹æ•°æ®(å¥å­)é•¿çŸ­åˆ†å¸ƒä¸€è‡´
> >      ```txt
> >      ğŸ‘‰ä¸å›ºå®šéšæœºç§å­:
> >         GPU1: å¯èƒ½éšæœºæŠ½åˆ°å¾ˆå¤šé•¿åºåˆ— -> è´Ÿè½½é‡(è®¡ç®—æ…¢) -> æ‰§è¡Œè®¡ç®—
> >         GPU2: å¯èƒ½éšæœºæŠ½åˆ°å¾ˆå¤šçŸ­åºåˆ— -> è´Ÿè½½é‡(è®¡ç®—æ…¢) -> ç©ºé—²ç­‰å¾…
> >      ```
> >    - å¡«å……ä¼˜åŒ–ï¼šä¸€æ‰¹æ•°æ®è¿›å…¥åˆ°$\text{GPU}$ä»éœ€å¡«å……è‡³æœ€é•¿ï¼Œä½†ç”±äºåˆ†ç»„$+$å¹³è¡¡ç­–ç•¥ï¼Œå®é™…å¡«å……æ•°å¾ˆä½
> > 3. æ‹†åˆ†ï¼šå¯¹åºåˆ—é•¿åº¦è¾ƒé•¿çš„$\text{Batch}$(å¦‚å›¾ä¸­å³è¾¹çš„$\text{4096/8192...}$)ï¼Œå†åˆ†å‰²æˆå­æ‰¹
> >    - æµç¨‹(é™„å½•$\text{B.3}$)ï¼šå¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹$\text{â†’}$åˆ†å­æ‰¹$\text{â†’}$é€ä¸ªå¤„ç†å­æ‰¹å¾—åˆ°åµŒå…¥$\text{â†’}$åˆå¹¶å¾—åˆ°åŸå§‹æ‰¹çš„åµŒå…¥
> > 4. å¹¿æ’­ï¼š$\text{GPU}$ä¼šå°†è‡ªå·±çš„åµŒå…¥ç»“æœå¹¿æ’­ç»™å…¶å®ƒ$\text{GPU}$ï¼Œä»¥æ‰©å¤§æ‰¹å†…è´Ÿæ ·æœ¬
> >    ```txt
> >    å¹¿æ’­å‰: 
> >      GPU1å¤„ç†: [A1, A2, A3]
> >      GPU2å¤„ç†: [B1, B2, B3]
> >    å¹¿æ’­åï¼š
> >      GPU1è·å¾—: [A1, A2, A3, B1, B2, B3]
> >      GPU2è·å¾—: [A1, A2, A3, B1, B2, B3]
> >    ```

# $\textbf{3. }$å®éªŒéªŒè¯

> ## $\textbf{3.1. }$å®éªŒè®¾ç½®
>
> > :one:å®éªŒé…ç½®
> >
> > 1. æ•°æ®é›†ï¼š$\text{MIRACL}$(åŒ…å«$\text{18}$ç§è¯­è¨€)
> > 2. è¯„ä¼°æŒ‡æ ‡ï¼š$\text{nDCG@10}$ï¼Œå…¶è¶Šé«˜è¡¨æ˜ç›¸å…³æ–‡æ¡£è¢«æ’åˆ°äº†è¶Šé å‰çš„ä½ç½®
> >
> > :two:æ£€ç´¢å®ç°
> >
> > 1. å•ç‹¬çš„ï¼š
> >    |    æ£€ç´¢æ–¹å¼     |      ç›®çš„      |     ç´¢å¼•æ„å»º     |       æ£€ç´¢ä»»åŠ¡        |
> >    | :-------------: | :------------: | :--------------: | :-------------------: |
> >    | $\text{Dense}$  | ç”Ÿæˆè¯­æ–™åº“åµŒå…¥ | $\text{Faiss}$åº“ | æ£€ç´¢$\text{Top-1000}$ |
> >    | $\text{Sparse}$ | ç”Ÿæˆè¯­æ–™åº“æƒé‡ | $\text{Lucene}$  | æ£€ç´¢$\text{Top-1000}$ |
> > 2. æ•´åˆçš„ï¼š
> >    |      æ£€ç´¢æ–¹å¼      | æ£€ç´¢å†…å®¹                         | é‡æ’ä¾æ®(ä»»åŠ¡$\textbf{1\&2}$)                                | é‡æ’ä¾æ®(ä»»åŠ¡$\textbf{3}$)                                   |
> >    | :----------------: | -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
> >    |    $\text{D+S}$    | å¹¶åˆå„è‡ª$\text{Top-1000}$        | $s_{\text {dense}}\text{+}0.3s_{\text {lex}}$                | $0.2s_{\text {dense}}\text{+}0.8s_{\text {lex}}$             |
> >    | $\text{Multi-vec}$ | $\text{Dense}$çš„$\text{Top-200}$ | $s_{\text {mul}}$                                            | $s_{\text {mul}}$                                            |
> >    |    $\text{All}$    | $\text{Dense}$çš„$\text{Top-200}$ | $s_{\text {dense}}\text{+}0.3  s_{\text {lex}}\text{+}s_{\text {mul}}$ | $0.15s_{\text {dense}}\text{+}0.5  s_{\text {lex}}\text{+}0.35s_{\text {mul}}$ |
>
> ## $\textbf{3.2. }$å®éªŒç»“æœ
>
> > ### $\textbf{3.2.1. }$åœ¨ä¸åŒä»»åŠ¡ä¸Š
> >
> > > :one:ä»»åŠ¡$1$ï¼šå¤šè¯­è¨€æ£€ç´¢
> > >
> > > 1. åŸºå‡†ï¼šè¯æ±‡æ£€ç´¢($\text{BM25}$)ï¼Œå¯†é›†æ£€ç´¢($\text{mDPR/mCont./mE5/E5-7b}$)ï¼Œå…¶å®ƒ($\text{Text-Emb.-L3}$)
> > > 2. ç»“æœï¼š$\text{Dense}$(æ€§èƒ½æœ€ä¼˜$\text{+}$åœ¨è¯­è¨€ä»¥å¤–è¯­è¨€æå‡æ›´å¤§)ï¼Œ$\text{Sparse}$(ç¢¾å‹$\text{BM25}$)ï¼Œ$\text{ALL}$(æ•ˆæœæœ€ä½³)
> > >
> > > :two:ä»»åŠ¡$2$ï¼šè·¨è¯­è¨€æ£€ç´¢
> > >
> > > 1. æ•°æ®ï¼šé‡‡ç”¨$\text{MKQA}$åŸºå‡†æ•°æ®é›†ï¼Œç”¨éè‹±è¯­æ£€ç´¢è‹±æ–‡ç»´åŸºç™¾ç§‘
> > > 2. ç»“æœï¼š$\text{Dense}$å°±å·²è¶…è¿‡åŸºå‡†ï¼Œä»$\text{Dense+Sparse}$åˆ°$\text{ALL}$æ€§èƒ½è¿›ä¸€æ­¥æå‡
> > >    - ä½†$\text{Sparse}$çš„æ€§èƒ½ä¸è¡Œï¼šæºäº$\text{Spaese}$ä¸»è¦åŸºäºè¯åˆ†å¸ƒï¼Œè€Œè·¨è¯­è¨€èƒŒæ™¯ä¸‹ï¼Œå…±åŒè¯æ±‡æœ‰é™
> > >    - åœ¨å°è¯­ç§ä¸Šè¡¨ç°ä¼˜å¼‚ï¼šå½’åŠŸäºå¹¿æ³›çš„æ— ç›‘ç£è®­ç»ƒ
> > >
> > > :three:ä»»åŠ¡$3$ï¼šé•¿æ–‡æ¡£æ£€ç´¢
> > >
> > > 1. æ•°æ®ï¼š$\text{MLDR}$(å¤šè¯­è¨€é•¿æ–‡æ¡£)ï¼Œ$\text{NarrativeQA}$(è‹±è¯­é•¿æ–‡æ¡£)ï¼Œ$\text{JinaEmbeddingv2}$(é¢å¤–åŸºå‡†)
> > > 2. ç»“æœï¼šåœ¨$\text{MLDR}$ä¸Šï¼Œ$\text{Sparse/MutiVec}$æ•ˆæœçªå‡ºï¼Œä½†è¿˜æ˜¯$\text{ALL}$å¾—åˆ†æœ€é«˜
> > > 3. æ¶ˆèï¼šå»é™¤é•¿æ–‡æ¡£çš„é™åˆ¶ï¼Œ$\text{Dense}$ä¾æ—§è¶…è¶Šå¾ˆå¤šåŸºå‡†
> >
> > ### $\textbf{3.2.2. }$æ¶ˆèå®éªŒ
> >
> > > :one:å®éªŒ$1$ï¼šè‡ªæˆ‘çŸ¥è¯†è’¸é¦çš„æ¶ˆè
> > >
> > > 1. æ¶ˆèæ–¹å¼ï¼šç¦ç”¨è‡ªçŸ¥è¯†è’¸é¦ï¼Œæ¯ç§æ£€ç´¢æ–¹å¼ç‹¬ç«‹è®­ç»ƒï¼Œç„¶åå†æ•´åˆ
> > > 2. å®éªŒç»“æœï¼šæ‰€æœ‰è‡ªè’¸é¦çš„$\text{Dense/Sparse/MultiVec}$æ•ˆæœï¼Œéƒ½æ¯”æ¶ˆèæ•´åˆæ¨¡å‹å¥½
> > >
> > > :two:å®éªŒ$2$ï¼šå¤šé˜¶æ®µè®­ç»ƒçš„æ¶ˆè
> > >
> > > 1. æ¶ˆèæ–¹å¼ï¼š
> > >    |    æ¨¡å‹    | $\textbf{XLM-RoBERTa}$æ¨¡å‹ | $\textbf{RetroMAE}$è°ƒæ•´ | æ— ç›‘ç£æ•°æ®é¢„è®­ç»ƒ |
> > >    | :--------: | :------------------------: | :---------------------: | :--------------: |
> > >    | $\text{1}$ |             âœ…              |            âŒ            |        âŒ         |
> > >    | $\text{2}$ |             âœ…              |            âœ…            |        âŒ         |
> > >    | $\text{3}$ |             âœ…              |            âœ…            |        âœ…         |
> > > 2. ç»“æœï¼š$\text{RetroMAE}$æ˜¾è‘—æé«˜äº†æ£€ç´¢æ€§èƒ½ï¼Œæ— ç›‘ç£è®­ç»ƒè¿›ä¸€æ­¥æé«˜äº†åµŒå…¥æ¨¡å‹çš„è´¨é‡