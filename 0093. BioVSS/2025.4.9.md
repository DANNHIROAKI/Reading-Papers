

# $\textbf{1. }$å…³äºŽ$\textbf{DESSERT}$

> :one:åŸºæœ¬åŽŸç†
>
> 1. å¯¹äºŽ$q_r\text{âˆˆ}Q$å’Œ$x_{ij}\text{âˆˆ}S_i$ï¼Œç»Ÿè®¡å…¶åœ¨$L$ä¸ª$\text{LSH}$å‡½æ•°$\psi_1,\psi_2,...,\psi_L$çš„åˆ†æ¡¶æƒ…å†µï¼Œè®°$\text{Count}(q_r,x_{ij})$ä¸ºäºŒè€…ç¢°æ’žæ¬¡æ•°
> 2. åŸºä¸Žå‡è®¾å³$\text{Pr}[\psi{(x)}\text{=}\psi{(y)}]\text{=}\text{Sim}(x,y)$ï¼Œä¸¤å‘é‡çš„ç¢°æ’žçŽ‡å¯ä½œä¸ºä¸¤å‘é‡çš„ç›¸ä¼¼åº¦
> 3. $q_r\text{âˆˆ}Q$å’Œ$x_{ij}\text{âˆˆ}S_i$çš„ç¢°æ’žçŽ‡çš„æ— åä¼°è®¡ä¸º$\cfrac{\text{Count}(q_r,x_{ij})}{L}$ï¼Œæ‰€ä»¥ç›¸ä¼¼åº¦çš„æ— åä¼°è®¡ä¸º$\hat{\text{Sim}}(q_r,x_{ij})\text{=}\cfrac{\text{Count}(q_r,x_{ij})}{L}$ 
> 4. é€šè¿‡å¯¹è¿‘ä¼¼çš„ç›¸ä¼¼åº¦è¿›è¡Œå†…éƒ¨èšåˆ($\text{MaxSim}$)å’Œå¤–éƒ¨èšåˆ(ç›¸åŠ )ï¼Œå¾—åˆ°æœ€ç»ˆç›¸ä¼¼åº¦
>
> :two:ç†è®ºè¯æ˜Žæ¦‚è¦
>
> 1. å®šä¹‰$\text{4.1}$ï¼šå‡½æ•°$Ïƒ(\mathbf{x})\text{:}â„^m\text{â†’}â„$åœ¨$U$ä¸Šæ˜¯$(Î±,Î²)\text{-}$æžå¤§çš„ï¼Œç­‰ä»·äºŽ$\forall{\mathbf{x}}\text{âˆˆ}U$æœ‰$\beta\max{(\mathbf{x})}\text{â‰¤}Ïƒ(\mathbf{x})\text{â‰¤}\alpha\max{(\mathbf{x})}$  
>
> 2. å¼•ç†$\text{4.1.2}$ï¼š$\Pr\left\lbrack{Ïƒ\left(\widehat{\mathbf{s}}\right)\text{â‰¥}Î±{s}_{\max}\text{+}\Delta}\right\rbrack\text{â‰¤}m{Î³}^{L}$å³$\Pr\left\lbrack{Ïƒ\left(\widehat{\mathbf{s}}\right)\text{â‰¥}Ï„}\right\rbrack\text{â‰¤}m{Î³}^{L}$ï¼Œå¯¹è¿‘ä¼¼ç›¸ä¼¼åº¦èšåˆåŽï¼Œå¤§æ¦‚çŽ‡ä¸è¶…è¿‡ç†è®ºä¸Šç•Œ
>
>    - åº”ç”¨$\text{Chernoff}$ç•Œé™å¾—åˆ°$\text{Pr}\left[Ïƒ\left(\hat{\mathbf{s}}\right){â‰¥}Ï„\right]{â‰¤}\cfrac{\displaystyle\sum_{j=1}^{m}\mathbb{E}\left[e^{tÎ±\hat{s}_j}\right]}{e^{tÏ„}}(t{>}0)$ 
>
>    - å°†$L$æ¬¡åˆ†æ¡¶çœ‹ä½œ$L$æ¬¡ä¼¯åŠªåˆ©ç‹¬ç«‹é‡å¤å®žéªŒï¼Œæ»¡è¶³äºŒé¡¹åˆ†å¸ƒ$\text{Count}\left(q_r, x_{ij}\right){\sim}\mathcal{B}\left(L, s_j\right)$  
>
>    - äºŒé¡¹åˆ†å¸ƒçš„çŸ©ç”Ÿæˆå‡½æ•°å‡½æ•°$\mathbb{E}\left[e^{tÎ±\hat{s}_j}\right]{=}\left(1{-}s_j{+}s_je^{\frac{tÎ±}{L}}\right)^L{â‰¤}\left(1{-}s_{\max}{+}s_{\max}{}e^{\frac{tÎ±}{L}}\right)^L$ä»¥
>
>    - æ‰€ä»¥$\text{Pr}\left[Ïƒ\left(\hat{\mathbf{s}}\right){â‰¥}Ï„\right]{â‰¤}\cfrac{m\left(1{-}s_{\max}{+}s_{\max}{}e^{\frac{tÎ±}{L}}\right)^L}{e^{tÏ„}}(t{>}0)$ 
>
>    - $f(t){=}\cfrac{m\left(1{-}s_{\max}{+}s_{\max}{}e^{\frac{tÎ±}{L}}\right)^L}{e^{tÏ„}}$åœ¨$t^*{=}\cfrac{L}{Î±}\ln{\left(\cfrac{Ï„(1{-}s_{\max})}{s_{\max}(Î±{-}Ï„)}\right)}$æ—¶å–å¾—çš„ä¸‹ç•Œ
>
>    - ä»£å…¥$t^*$å°±æ˜¯$\Pr\left\lbrack{Ïƒ\left(\widehat{\mathbf{s}}\right)\text{â‰¥}Ï„}\right\rbrack\text{â‰¤}m\left(\left(\cfrac{Î±\left({1{-}{s_{\max}}}\right)}{Î±{-}Ï„}\right){\left(\cfrac{{s_{\max}}\left({Î±{-}Ï„}\right)}{Ï„\left({1{-}{s_{\max}}}\right)}\right)}^{\frac{Ï„}{Î±}}\right){=}mÎ³^L$ 
>
>    - è¿›ä¸€æ­¥è¯´æ˜Ž$Î³{<}1$(æ­¤æ—¶$mÎ³^L$æ‰æ”¶æ•›)ï¼š$Î³$åœ¨$Ï„$ä¸Šå•è°ƒé€’å‡ï¼Œåœ¨$Ï„$çš„ä¸¤ç«¯æœ‰ä¸¤ä¸ªæžé™å€¼$1$å’Œ$s_{\max}$ï¼Œæ‰€ä»¥$Î³{âˆˆ}\left(s_{\max},1\right)$ 
>
>      <img src="https://i-blog.csdnimg.cn/direct/3e7d62075c144b44b8cd692381330134.png"  width=500 /> 
>
> 3. å¼•ç†$\text{4.1.3}$ï¼š$\Pr\left\lbrack{Ïƒ\left(\widehat{\mathbf{s}}\right)\text{â‰¤}Î²{s}_{\max}\text{{-}}\Delta}\right\rbrack\text{â‰¤}2{e}^{{-}{2L}{\Delta}^{2}/{Î²}^{2}}$ï¼Œå¯¹è¿‘ä¼¼ç›¸ä¼¼åº¦èšåˆåŽï¼Œå¤§æ¦‚çŽ‡ä¸ä½ŽäºŽç†è®ºä¸‹ç•Œ
>
>    - ç”±$Ïƒ$æ˜¯$(Î±,Î²)\text{-}$æžå¤§çš„ï¼Œ$\Pr\left[Ïƒ{\left(\hat{\mathbf{s}}\right)}{â‰¤}Î²{s_{\max}}{-}\Delta\right]$è¿›ä¸€æ­¥è½¬åŒ–ä¸º$\Pr\left[Î²\hat{s}_{\max}{â‰¤}Î²{s_{\max}}{-}\Delta\right]{â‰¤}\Pr\left[Î²\left|{s_{\max}}{-}\hat{s}_{\max}\right|{â‰¥}\Delta\right]$
>    - åœ¨$s_{\max}{=}\text{Sim}\left(q_r,x_{ij}^*\right)$ä¸­ï¼Œè®©$X_i$æŒ‡ç¤º$q_r$å’Œ$x_{ij}^*$ç¬¬$i$æ¬¡åˆ†æ¡¶çš„ä¼¯åŠªåˆ©éšæœºå˜é‡ï¼Œå³$\hat{s}_{\max}{=}\hat{\text{Sim}}\left(q_r,x_{ij}^*\right){=}\cfrac{1}{L}\displaystyle{}\sum_{i{=}1}^LX_i$
>    - å¸¦å…¥$\text{Hoeffding}$ä¸ç­‰å¼$\displaystyle\Pr\left[\left|\frac{1}{L}\sum_{i{=}1}^LX_i{-}\mathbb{E}\left[\frac{1}{L}\sum_{i{=}1}^LX_i\right]\right|{â‰¥}t\right]{â‰¤}2e^{{-}2Lt^2}$
>    - ä»¤$t{=}\cfrac{\Delta}{Î²}$å°±å¯å˜æ¢å¾—$\Pr\left[Î²\left|{s_{\max}}{-}\hat{s}_{\max}\right|{â‰¥}\Delta\right]{â‰¤}2e^{{-}2L\Delta^2{/}Î²^2}$
>
> 4. å®šç†$\text{4.2}$ï¼š$\Delta{ï¼ž}0$æ—¶$\text{DESSERT}$ç®—æ³•ç»“æž„èƒ½ä»¥$1{-}\delta$çš„æ¦‚çŽ‡è¿”å›žä¸Ž$Q$ç›¸ä¼¼åº¦æœ€é«˜çš„$S^*$ï¼Œå³$\Pr\left[\forall{i}{,}\hat{F}(Q,S^*){>}\hat{F}(Q,S_i)\right]{â‰¥}1{-}\delta$ 
>
>    |          ç¬¦å·          | å«ä¹‰                                                         |
>    | :--------------------: | :----------------------------------------------------------- |
>    | $F(Q, S^*)$çš„ä¸‹ç•Œ$B^*$ | $B^*\text{=}\displaystyle{}\frac{\beta}{m_q}\sum_{r=1}^{m_q}w_rs_{r\max}^*$å³$S^*$çš„ä¿å®ˆä¼°è®¡ |
>    | $F(Q, S_i)$çš„ä¸Šç•Œ$B_i$ | $B_i\text{=}\displaystyle{}\frac{\alpha}{m_q}\sum_{r=1}^{m_q}w_r\hat{s}_{ri\max}$å³$S_i$çš„ä¹è§‚ä¼°è®¡ï¼Œ$S^*{\notin}\{S_i\}$æ—¶$B_i$æœ€å¤§å€¼ä¸º$B_{i\max}$ï¼ŒåŠ$\Delta{\text{=}}\cfrac{B^*â€“B_{i\max}}{3}$ |
>
>    - ä¸Šç•ŒæŽ§åˆ¶ï¼šé€šè¿‡è®¾ç½®$L$ä»Žè€Œé™åˆ¶æ‰€æœ‰éžæœ€ä¼˜é›†åˆ$S_i$çš„è¿‘ä¼¼å¾—åˆ†$\hat{F}(Q,S_i)$ï¼Œç¡®ä¿æ‰€æœ‰$\sigma(\hat{\mathbf{s}}_{ri})$ä¸è¶…è¿‡$\alpha\hat{s}_{ri\max}{+}\Delta_{ri}$ 
>      - ä»£å…¥å¼•ç†$\text{4.1.2}$ç»“è®º$\Pr\left\lbrack{Ïƒ\left(\widehat{\mathbf{s}}\right)\text{â‰¥}Î±{s}_{\max}\text{+}\Delta}\right\rbrack\text{â‰¤}m{Î³}^{L}$
>      - å¯¹$(N{-}1)m_q$ä¸ªè¿™æ ·çš„äº‹ä»¶åº”ç”¨è¿žè¿žæŽ¥è¾¹ç•Œï¼Œå¹¶è®¾ç½®å…¶å¤±è´¥æ¦‚çŽ‡ä¸Šé™ä¸º$\delta/2$
>      - æ‰€ä»¥æœ‰$(N{-}1)m_q m (\gamma_{ri})_{\max}^L {\leq} \cfrac{\delta}{2}$è§£å¾—$L {\geq} \cfrac{\log \left( \frac{2 (N-1) m_q m}{\delta} \right)}{\log \left( \frac{1}{(\gamma_{ri})_{\max}} \right)}$ 
>    - ä¸‹ç•ŒæŽ§åˆ¶ï¼šè¿˜æ˜¯é€šè¿‡è®¾ç½®$L$ï¼Œæœ€ä¼˜é›†åˆ$S^*$çš„è¿‘ä¼¼å¾—åˆ†$\hat{F}(Q,S^*)$ä¸ä½ŽäºŽ${\beta}s_{r\max}^*{-}\Delta_{ri}$
>      - ä»£å…¥å¼•ç†$\text{4.1.3}$ç»“è®º$\Pr\left\lbrack{Ïƒ\left(\widehat{\mathbf{s}}\right)\text{â‰¤}Î²{s}_{\max}\text{{-}}\Delta}\right\rbrack\text{â‰¤}2{e}^{{-}{2L}{\Delta}^{2}/{Î²}^{2}}$ 
>      - å¯¹æ‰€æœ‰$m_q$ä¸ªæŸ¥è¯¢å‘é‡åº”ç”¨è”åˆè¾¹ç•Œï¼Œå¹¶è®¾ç½®å…¶å¤±è´¥æ¦‚çŽ‡ä¸Šé™ä¸º$\delta/2$
>      - æ‰€ä»¥æœ‰$2 m_q e^{-2L \Delta_{ri}^2 / \beta^2} {\leq} \cfrac{\delta}{2}$æ‰€ä»¥$L {\geq} \cfrac{\log \left( \frac{4 m_q}{\delta} \right) \beta^2}{2 \Delta_{ri}^2}$ 
>    - è®¾å®š$\displaystyle{}L = \max \left( \frac{\log \left( \frac{2 (N-1) m_q m}{\delta} \right)}{\log \left( \frac{1}{(\gamma_{ri})_{\max}} \right)}, \frac{\log \left( \frac{4 m_q}{\delta} \right) \beta^2}{2 \Delta_{ri}^2} \right)$
>      - ç„¶åŽè¯æ˜Žè¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰$\hat{F}(Q,S^*){>}\hat{F}(Q,S_i)$ 
>      - $L$çš„æ¸è¿›å¤æ‚åº¦ä¸º$L = O\left( \log \left( \cfrac{N m_q m}{\delta} \right) \right)$ 
>
> :three:ä¸€äº›æƒ³æ³•
>
> 1. ä¹‹å‰åˆ†æ¡¶å•å‘é‡çš„$\text{Idea}$å’Œ$\text{DESSERT}$çš„è”ç³»ï¼šå½“$\text{DESSERT}$çš„å†…éƒ¨èšåˆ$\sigma$é‡‡ç”¨å¹³å‡å€¼èšåˆæ—¶ï¼ŒäºŒè€…å®Œå…¨ç­‰ä»·
>
>    ```txt
>    ðŸ‘‰ä¸¾ä¸ªç®€å•çš„ä¾‹å­: 
>      Q = {q1, q2, q3, q4}
>      S = {x1, x2, x3, x4, x5, x6}
>      Ïˆ = {Ïˆ1, Ïˆ2, Ïˆ3}
>    ðŸ‘‰éšä¾¿å‡è®¾ä¸€ç§åˆ†æ¡¶çš„ç»“
>          Bucket-1  |  Bucket-2  |  Bucket-3  |  Bucket-4   
>      Ïˆ1  q1,q2,x1  |  q3,x2,x3  |  q4,x4     |  x5,x6   
>      Ïˆ2  q1,x2     |  q3,x3,x1  |  q4,x4     |  q2,x5,x6 
>      Ïˆ3  q4,x3,x2  |  q1,q2,x5  |  q3,x1     |  x4,x6
>    ðŸ‘‰ç»Ÿè®¡ç¢°æ’žæ¬¡æ•°
>          x1  x2  x3  x4  x5  x6
>      q1   1   1   0   0   1   0  ---> å¹³å‡å€¼å†…éƒ¨èšåˆ = 3/5
>      q2   1   0   0   0   2   1  ---> å¹³å‡å€¼å†…éƒ¨èšåˆ = 4/5
>      q3   2   1   2   0   0   0  ---> å¹³å‡å€¼å†…éƒ¨èšåˆ = 5/5  ---> æ±‚å’Œå¤–éƒ¨èšåˆ = 16/5
>      q4   0   1   1   2   0   0  ---> å¹³å‡å€¼å†…éƒ¨èšåˆ = 4/5
>    ðŸ‘‰ç”Ÿæˆå•å‘é‡
>      Q' = (2, 1, 1, 0, 1, 1, 1, 1, 1, 2, 1, 0)
>      S' = (1, 2, 1, 2, 1, 2, 1, 2, 2, 1, 1, 2)  ---> å†…ç§¯ = 16  ---> å½’ä¸€åŒ– = 16/5 
>    ```
>
> 2. è‡³äºŽç†è®ºä¿è¯ï¼š
>
>    - $\text{DESSERT}$å†…éƒ¨èšåˆçš„ç†è®ºä¿è¯åªè¦æ±‚$Ïƒ$æ˜¯$(Î±,Î²)\text{-}$æžå¤§çš„ï¼Œå¹¶æ²¡æœ‰ä¸€å®šè¦å’Œ$\text{ColBERT}$ä¸€æ ·æ˜¯æœ€å¤§å€¼èšåˆ
>    - å½“$\sigma(\mathbf{x})$å˜ä¸ºæ±‚${\mathbf{x}}$ä¸­æ¯ä¸ªå…ƒç´ çš„å¹³å‡ï¼Œä¸”${\mathbf{x}}$ä¸­æœ‰$m$ä¸ªå…ƒç´ æ¯ä¸ªå…ƒç´ éƒ½å¤§äºŽ$0$æ—¶ï¼Œ$Ïƒ$æ˜¯$\left(1,\cfrac{1}{m}\right)$æžå¤§çš„
>    - $\text{DESSERT}$å¤–éƒ¨èšåˆç†è®ºä¿è¯å®Œå…¨ä¾èµ–äºŽå†…éƒ¨èšåˆçš„ç»“è®ºï¼Œæ•…ä¹Ÿæˆç«‹

# $\textbf{2. }$å®žéªŒåŠç»“æžœ

> :one:å®žéªŒè®¾ç½®
>
> 1. $\text{PLAID}$ï¼šå€™é€‰æ•°$n_{\text{docs}}{=}4096$ï¼Œé‡æŽ’æ•°$k{=}1000$ï¼ŒæŽ¢æµ‹è´¨å¿ƒæ•°$n_\text{probe}{=}4$ï¼Œå‰ªæžé˜ˆå€¼$t_{cs}{=}0.4$ 
> 2. $\text{Muvera}$ï¼šæ¡¶ç¼–ç é•¿$k_{\text{sim}}{=}5$ï¼ŒæŠ•å½±ç»´åº¦$d_{\text{proj}}{=}16$ï¼Œé‡å¤æ¬¡æ•°$R_\text{reps}{=}20$ï¼Œä¸€å…±$\text{10240}$ç»´ 
>    - ç«¯åˆ°ç«¯ä¸Šï¼šåŽ‹ç¼©$\text{PQ-256-8}$ï¼Œ$\text{DiskANN}$è®¾ç½®å’ŒåŽŸè®ºæ–‡ä¸€è‡´
> 3. $\text{DESSERT}$ï¼š
>    - é¢„è¿‡æ»¤é˜¶æ®µï¼šæŽ¢æµ‹è´¨å¿ƒæ•°$n_\text{probe}{=}4$ï¼Œå€™é€‰æ•°$n_{\text{docs}}{=}4096$ï¼Œè¿™éƒ¨åˆ†äºŽ$\text{PLAID}$ä¸€è‡´
>    - å“ˆå¸Œæœ‰å…³çš„ï¼šå“ˆå¸Œå‡½æ•°$L{=}128$ä¸ªï¼Œæ¯ä¸ªå“ˆå¸Œå‡½æ•°æœ‰$\text{128}$ä¸ªæ¡¶(å…±$\text{10240}$ä¸ªæ¡¶å’Œ$\text{Muvera}$ä¸€è‡´)
> 4. $\text{Ours}$ï¼š
>    - å’Œ$\text{DESSERT}$å®Œå…¨ä¿æŒä¸€è‡´ï¼Œä¸€ä¸ªæ¡¶å¯¹åº”ä¸€ä¸ªç»´åº¦ï¼Œæ•…ä¸€å…±$\text{10240}$ç»´åº¦çš„å•å‘é‡
>    - å¯¹å•å‘é‡çš„æ£€ç´¢å’Œ$\text{Muvera}$ä¸€è‡´
>
> :two:å®žéªŒç»“æžœ
>
> <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20250409182141453.png" alt="image-20250409175910916" style="zoom:45%;" /> <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20250409181349446.png" alt="image-20250409181349446" style="zoom:45%;" /><img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20250409180240225.png" alt="image-20250409180240225" style="zoom:45%;" /> 
>
> <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20250409180859414.png" alt="image-20250409180752068" style="zoom:45%;" />  <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20250409181725954.png" alt="image-20250409181725954" style="zoom:45%;" /> <img src="https://raw.githubusercontent.com/DANNHIROAKI/New-Picture-Bed/main/img/image-20250409182657808.png" alt="image-20250409182657808" style="zoom:45%;" /> 
>
>  